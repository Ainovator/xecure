{% extends 'base.html' %}

{% block title %}–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ{% endblock %}

{% set page_class = "admin-background" %}

{% block content %}
<div class="admin-panel">
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="admin-content">

        <!-- –í–∫–ª–∞–¥–∫–∞ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" -->
        <section id="users-tab" class="tab-content active">
            <h1>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
            {% if users %}
                <div class="table-container">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                                <th>–†–æ–ª—å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                                <tr>
                                    <td>{{ user.id }}</td>
                                    <td>{{ user.username }}</td>
                                    <td>{{ user.role }}</td>
                                    <td>
                                        <form action="{{ url_for('auth.delete_user') }}" method="POST">
                                            <input type="hidden" name="user_id" value="{{ user.id }}">
                                            <button type="submit" class="delete-button">
                                                <span class="delete-icon">üóë</span> –£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
            {% endif %}
        </section>

        <!-- –í–∫–ª–∞–¥–∫–∞ "–û—Ç—á—ë—Ç—ã" -->
        <section id="reports-tab" class="tab-content">
            <h1>–°–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤</h1>
            {% if reports %}
                <div class="table-container">
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for report in reports %}
                                <tr>
                                    <td>{{ report.id }}</td>
                                    <td>{{ report.title }}</td>
                                    <td>{{ report.content[:100] }}...</td>
                                    <td>
                                        <form action="{{ url_for('auth.admin_panel') }}" method="POST">
                                            <input type="hidden" name="report_id" value="{{ report.id }}">
                                            <button type="submit" class="delete-button">
                                                <span class="delete-icon">üóë</span> –£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p>–û—Ç—á—ë—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
            {% endif %}
        </section>

<!-- –í–∫–ª–∞–¥–∫–∞ "–ó–∞–ø—Ä–æ—Å—ã" -->
        <section id="requests-tab" class="tab-content">
            <h1>–ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –¥–æ—Å—Ç—É–ø</h1>
            {% if requests %}
                <div class="requests-list">
                    {% for request in requests %}
                        <div class="request-card">
                            <h4>–û—Ç—á—ë—Ç: {{ request.parent_report.title }}</h4>
                            <p><strong>–û—Ç –∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å:</strong> {{ request.user.username }}</p>
                            <div class="request-actions">
                                {% if not request.approved %}
                                    <form action="{{ url_for('auth.approve_report', report_id=request.parent_report.id) }}" method="POST">
                                        <label for="access_duration_{{ request.id }}">–í—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö):</label>
                                        <input type="number" name="access_duration" min="1" value="60" id="access_duration_{{ request.id }}" required>
                                        <button type="submit" class="btn btn-success">–û–¥–æ–±—Ä–∏—Ç—å</button>
                                    </form>
                                    <form action="{{ url_for('auth.reject_request', request_id=request.id) }}" method="POST">
                                        <button type="submit" class="btn btn-danger">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                                    </form>
                                {% else %}
                                    <p>–î–æ—Å—Ç—É–ø —É–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω.</p>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –¥–æ—Å—Ç—É–ø.</p>
            {% endif %}
        </section>
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <aside class="sidebar">
        <nav>
            <!-- –ú–æ–¥—É–ª—å "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ" -->
            <div class="module">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                <ul>
                    <li>
                        <button class="tab-link active" data-tab="users-tab">
                            <span class="tab-icon">üë§</span> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                        </button>
                    </li>
                    <li>
                        <button class="tab-link" data-tab="reports-tab">
                            <span class="tab-icon">üìä</span> –û—Ç—á—ë—Ç—ã
                        </button>
                    </li>
                    <li>
                        <button class="tab-link" data-tab="requests-tab">
                            <span class="tab-icon">üì©</span> –ó–∞–ø—Ä–æ—Å—ã
                        </button>
                    </li>
                </ul>
            </div>

            <!-- –ú–æ–¥—É–ª—å "–î–µ–π—Å—Ç–≤–∏—è" -->
            <div class="module">
                <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
                <ul>
                    <li>
                        <button class="action-button" onclick="location.href='{{ url_for('auth.create_report') }}';">
                            <span class="tab-icon">‚ûï</span> –°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç
                        </button>
                    </li>
                </ul>
            </div>
        </nav>
    </aside>
</div>
{% endblock %}